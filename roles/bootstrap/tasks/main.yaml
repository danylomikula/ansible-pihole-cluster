---
- name: Set timezone
  community.general.timezone:
    name: "{{ bootstrap_timezone }}"
  tags:
    - bootstrap
    - timezone

- name: Install SELinux Python bindings for RedHat
  when: ansible_facts['os_family'] == "RedHat"
  ansible.builtin.package:
    name:
      - python3-libselinux
      - python3-requests
    state: present
  tags:
    - bootstrap
    - packages
    - selinux

- name: Disable SELinux
  when:
    - ansible_facts['os_family'] == "RedHat"
  ansible.posix.selinux:
    state: disabled
  tags:
    - bootstrap
    - selinux

- name: Install common dependencies
  ansible.builtin.package:
    name: "{{ bootstrap_install_packages }}"
    state: present
  tags:
    - bootstrap
    - packages

- name: Install DNS utilities (Debian/Ubuntu)
  ansible.builtin.package:
    name: dnsutils
    state: present
  when: ansible_facts['os_family'] == "Debian"
  tags:
    - bootstrap
    - packages

- name: Install DNS utilities (RedHat)
  ansible.builtin.package:
    name: bind-utils
    state: present
  when: ansible_facts['os_family'] == "RedHat"
  tags:
    - bootstrap
    - packages

- name: Set hostname
  ansible.builtin.hostname:
    name: "{{ inventory_hostname }}"
  notify: Reboot after hostname change
  tags:
    - bootstrap
    - hostname

- name: Populate service facts
  ansible.builtin.service_facts:
  tags:
    - bootstrap
    - facts

- name: Flush handlers
  ansible.builtin.meta: flush_handlers
