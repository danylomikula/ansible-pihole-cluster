services:
  nebula-sync:
    image: "ghcr.io/lovelaze/nebula-sync:{{ nebula_sync_version }}"
    container_name: nebula-sync
    restart: unless-stopped
    environment:
      PRIMARY: "http://{{ ansible_host }}|${PIHOLE_PASSWORD}"
      REPLICAS: "{% for backup_host in groups['backup'] %}http://{{ hostvars[backup_host].ansible_host }}|${PIHOLE_PASSWORD}{% if not loop.last %},{% endif %}{% endfor %}"
      FULL_SYNC: "{{ nebula_sync_full_sync }}"
      RUN_GRAVITY: "{{ nebula_sync_run_gravity }}"
      CRON: "{{ nebula_sync_cron }}"
      CLIENT_SKIP_TLS_VERIFICATION: "{{ nebula_sync_client_skip_tls_verification }}"
{% if not nebula_sync_full_sync | bool %}
{% for key, val in nebula_sync_additional_settings | dictsort %}
      {{ key }}: "{{ val }}"
{% endfor %}
{% endif %}
